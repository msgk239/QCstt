# 热词管理系统开发文档

## 功能概述

开发一个与 keywords 文件同步的热词管理系统，实现前后端双向同步，并确保数据的正确性和安全性。

## 系统架构

### 后端文件结构

```
server/
├── api/
│   ├── speech/
│   │   ├── keywords              # 原始 keywords 文件
│   │   ├── keywords.backup       # 自动备份文件
│   │   ├── update_keywords.py    # 现有的更新脚本
│   │   └── hotwords.py          # 新增：热词管理接口处理
│   └── app.py                    # 新增热词管理相关路由
```

### 前端文件结构

```
frontend/src/
├── api/
│   └── hotword.js               # 热词管理 API 接口
├── views/
│   └── HotwordsManagement.vue   # 新增：热词管理页面
└── components/
    └── AppSidebar.vue           # 修改：添加导航入口
```

## API 接口设计

### 1. 获取热词列表

```python
@app.route('/api/hotwords', methods=['GET'])
def get_hotwords():
    return {
        'code': 0,
        'data': {
            'content': '文件内容',
            'lastModified': '最后修改时间'
        }
    }
```

### 2. 更新热词

```python
@app.route('/api/hotwords', methods=['POST'])
def update_hotwords():
    return {
        'code': 0,
        'message': '更新成功'
    }
```

### 3. 验证热词格式

```python
@app.route('/api/hotwords/validate', methods=['POST'])
def validate_hotwords():
    return {
        'code': 0,
        'data': {
            'isValid': True,
            'errors': []
        }
    }
```

## 前端页面功能

### 1. 编辑器功能

- 语法高亮
- 行号显示
- 实时格式检查
- 错误提示

### 2. 格式检查规则

#### 词语格式检查
```python
def is_chinese_word(word: str) -> bool:
    """检查词是否有效
    
    规则：
    1. 纯英文词允许（比如 DNA）
    2. 中文词必须至少两个字，或一个字加数字/英文
    3. 不允许包含符号（包括标点符号）
    4. 不能全是数字
    
    示例：
    - 允许：
      - "DNA" (纯英文)
      - "测试" (两个中文字)
      - "T灵" (中文+英文)
      - "第1" (中文+数字)
    
    - 不允许：
      - "测" (单个中文字)
      - "123" (全是数字)
      - "测试+" (包含符号)
    """
```

#### 前端格式检查
- 实时检查：
  - 每行格式：`目标词 [阈值] [原词列表] [(上下文词)]`
  - 目标词：不能为空
  - 阈值：如果存在，必须是0-1之间的数字
  - 原词列表：用逗号分隔，支持中英文逗号
  - 上下文词：必须用括号包围，内部用逗号分隔

- 错误提示：
  - 多余空格：行中包含连续两个以上空格
  - 括号不匹配：`(` 和 `)` 数量不对应
  - 括号顺序错误：`)` 在 `(` 前面出现
  - 阈值格式错误：不是0-1之间的数字
  - 重复目标词：同一个目标词出现多次

- 自动修正：
  - 中文标点自动转换为英文标点：
    - `，` -> `,`
    - `（` -> `(`
    - `）` -> `)`
  - 去除行首尾空格
  - 合并连续空格

#### 后端格式检查
- 重复目标词检查
- 格式规范检查：
  - 空格数量
  - 阈值格式 (0-1之间的数字)
  - 括号匹配
  - 逗号格式

### 3. 词语有效性检查

#### 目标词/原词检查规则
```python
def is_chinese_word(word: str) -> bool:
    """判断是否是有效的词
    
    规则：
    1. 必须包含至少两个中文字符，或一个中文字符加数字
    2. 不允许包含符号（包括标点符号）
    3. 不能全是数字
    
    示例：
    - 允许：
      - "测试词" (两个中文字)
      - "第1" (一个中文字+数字)
      - "测试test" (两个中文字+英文)
      - "第1名" (两个中文字+数字)
    
    - 不允许：
      - "测" (只有一个中文字)
      - "中-文" (包含符号)
      - "测试。" (包含标点)
      - "123" (全是数字)
      - "test" (没有中文字)
    """
```

#### 格式解析规则
- 目标词：必须是有效词
- 阈值：可选，0-1之间的浮点数
- 原词列表：
  - 用逗号分隔（支持中英文逗号）
  - 每个原词必须是有效词
- 上下文词：
  - 用括号包围
  - 内部用逗号分隔
  - 每个上下文词必须是有效词

#### 示例
```
第七灵 0.9 第七名,第7名,第七0,第70 (上下文词1,上下文词2)
```
- 目标词：第七灵（3个中文字）
- 阈值：0.9
- 原词列表：
  - 第七名（3个中文字）
  - 第7名（2个中文字+数字）
  - 第七0（2个中文字+数字）
  - 第70（1个中文字+数字）
- 上下文词：上下文词1,上下文词2

### 4. 操作功能

- 保存
- 导出备份
- 撤销/重做
- 格式化


## 后续优化

1. 功能扩展

   - 批量导入
   - 智能纠错
   - 统计分析
2. 性能优化

   - 大文件处理
   - 缓存机制
   - 增量更新
3. 用户体验

   - 快捷键支持
   - 主题定制
   - 操作引导


## 测试方案

- 内容加载与保存
- 实时格式验证
- 页面加载 < 1s

