# keywords文件及相关文件说明

## 文件关系图
```
keywords (源文件)
    │
    ├── custom_dict.txt (分词词典)
    │       └── 由_generate_custom_dict()生成
    │           - 包含目标词、错误词、上下文词
    │           - 按长度排序
    │           - 用于pkuseg分词器
    │
    ├── correction_config.yaml (配置缓存)
    │       └── 由load_config()生成
    │           - 缓存拼音计算结果
    │           - 存储阈值和上下文设置
    │           - 避免重复解析keywords
    │
    └── 内存数据结构
            ├── self.target_words
            │   - 格式: {word: (pinyin_list, context_words, threshold, orig_words)}
            │   - 用于相似度匹配
            │
            └── self.original_words_map
                - 格式: {orig_word: target_word}
                - 用于直接替换
```

## 核心文件说明

### 1. keywords文件
- **用途**：核心配置文件，定义所有纠正规则
- **格式**：
  ```
  目标词 [阈值] [原词列表] [(上下文词)]
  ```
- **示例**：
  ```
  灵体 0.8 林体,零体 (灵核,古零)
  ```
- **字段说明**：
  - 目标词：要纠正到的目标词
  - 阈值：相似度匹配阈值，可选，默认0.8
  - 原词列表：直接替换的词列表，用逗号分隔
  - 上下文词：触发替换的上下文条件，用括号包围

### 2. custom_dict.txt
- **用途**：分词器的自定义词典
- **生成时机**：
  - 首次运行时
  - keywords文件更新时
- **生成逻辑**：
  1. 提取所有中文词（长度>1）
  2. 按长度降序排序
  3. 按优先级写入：目标词 > 错误词 > 上下文词
- **作用**：
  - 指导pkuseg分词器识别专业术语
  - 避免错误分词影响纠正效果

### 3. correction_config.yaml
- **用途**：配置缓存文件
- **内容**：
  ```yaml
  target_words:
    灵体:
      pinyin: [ling2, ti3]
      context_words: [灵核, 古零]
      similarity_threshold: 0.8
      original_words: [林体, 零体]
  ```
- **更新时机**：
  - keywords文件更新时
  - 首次运行时
- **作用**：
  - 缓存拼音计算结果
  - 避免重复解析keywords文件
  - 提高启动和运行效率

## 内存数据结构

### 1. self.target_words
- **用途**：存储目标词的完整信息
- **格式**：
  ```python
  {
    "灵体": (
      ["ling2", "ti3"],  # 拼音列表
      ["灵核", "古零"],   # 上下文词列表
      0.8,               # 相似度阈值
      ["林体", "零体"]    # 原词列表
    )
  }
  ```
- **使用场景**：
  - 相似度匹配
  - 上下文判断
  - 阈值检查

### 2. self.original_words_map
- **用途**：存储原词到目标词的直接映射
- **格式**：
  ```python
  {
    "林体": "灵体",
    "零体": "灵体"
  }
  ```
- **使用场景**：
  - 直接替换已知的错误词
  - 优先级高于相似度匹配

## 文件更新流程

1. 修改keywords文件
2. 程序检测到keywords更新：
   - 重新生成custom_dict.txt
   - 更新correction_config.yaml
   - 刷新内存数据结构

## 注意事项

1. keywords文件修改建议：
   - 保持格式规范
   - 合理设置阈值
   - 避免原词循环引用
   - 合理使用上下文条件

2. 性能优化建议：
   - 定期清理无效配置
   - 及时更新常见错误词
   - 适当调整相似度阈值
   - 避免过多的上下文限制 